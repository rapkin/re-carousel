"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),styles={wrapper:{width:"100%",height:"100%",position:"relative"},frame:{width:"100%",height:"100%",position:"absolute"}},Carousel=function(e){function t(t){e.call(this,t),this.state={frames:[].concat(t.frames||t.children||[]),currentFrameIndex:t.onStartFrameIndex},this.mounted=!1,this.debounceTimeoutId=null,this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onResize=this.onResize.bind(this),this.autoSlide=this.autoSlide.bind(this),this.prev=this.prev.bind(this),this.next=this.next.bind(this),this.setFrame=this.setFrame.bind(this),!1===t.loop&&t.auto&&console.warn("[re-carousel] Auto-slide only works in loop mode.")}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.componentDidMount=function(){this.mounted=!0,this.prepareAutoSlide(),this.hideFrames(),this.refs.wrapper.addEventListener("touchmove",this.onTouchMove,{capture:!0}),this.refs.wrapper.addEventListener("touchend",this.onTouchEnd,{capture:!0}),window.addEventListener("resize",this.onResize),this.state.currentFrameIndex&&this.setFrame(this.state.currentFrameIndex)},t.prototype.componentWillUnmount=function(){this.mounted=!1,this.clearAutoTimeout(),this.refs.wrapper.removeEventListener("touchmove",this.onTouchMove,{capture:!0}),this.refs.wrapper.removeEventListener("touchend",this.onTouchEnd,{capture:!0}),window.removeEventListener("resize",this.onResize)},t.prototype.componentDidUpdate=function(t,e){this.state.frames.length&&this.state.frames.length!==e.frames.length&&(this.hideFrames(),this.prepareAutoSlide())},t.getDerivedStateFromProps=function(t,e){var r=[].concat(t.frames||t.children||[]),s={frames:r};return r.length&&r.length!==e.frames.length&&(s.currentFrameIndex=0),s},t.prototype.hideFrames=function(){for(var t=1;t<this.state.frames.length;t++)this.refs["f"+t].style.opacity=0},t.prototype.onResize=function(){var t=this;clearTimeout(this.debounceTimeoutId),this.debounceTimeoutId=setTimeout(function(){t.updateFrameSize(function(){t.prepareSiblingFrames()})},25)},t.prototype.onTouchStart=function(t){if(!(this.state.frames.length<2)){this.clearAutoTimeout(),this.updateFrameSize(),this.prepareSiblingFrames();var e=t.touches&&t.touches[0]||t,r=e.pageX,s=e.pageY;this.setState({startX:r,startY:s,deltaX:0,deltaY:0}),this.refs.wrapper.addEventListener("mousemove",this.onTouchMove,{capture:!0}),this.refs.wrapper.addEventListener("mouseup",this.onTouchEnd,{capture:!0}),this.refs.wrapper.addEventListener("mouseleave",this.onTouchEnd,{capture:!0})}},t.prototype.onTouchMove=function(t){if(!(t.touches&&1<t.touches.length)){this.clearAutoTimeout();var e=t.touches&&t.touches[0]||t,r=e.pageX,s=e.pageY,a=r-this.state.startX,i=s-this.state.startY;this.setState({deltaX:a,deltaY:i}),"x"===this.props.axis&&Math.abs(a)>Math.abs(i)&&(t.preventDefault(),t.stopPropagation()),"y"===this.props.axis&&Math.abs(i)>Math.abs(a)&&(t.preventDefault(),t.stopPropagation()),this.props.loop||(this.state.currentFrameIndex===this.state.frames.length-1&&(a<0&&(a/=3),i<0&&(i/=3)),0===this.state.currentFrameIndex&&(0<a&&(a/=3),0<i&&(i/=3))),this.moveFramesBy(a,i)}},t.prototype.onTouchEnd=function(){var t=this,e=this.decideEndPosition();e&&this.transitFramesTowards(e),this.refs.wrapper.removeEventListener("mousemove",this.onTouchMove,{capture:!0}),this.refs.wrapper.removeEventListener("mouseup",this.onTouchEnd,{capture:!0}),this.refs.wrapper.removeEventListener("mouseleave",this.onTouchEnd,{capture:!0}),setTimeout(function(){return t.prepareAutoSlide()},this.props.duration)},t.prototype.decideEndPosition=function(){var t=this.state,e=t.deltaX;void 0===e&&(e=0);var r=t.deltaY;void 0===r&&(r=0);var s=t.currentFrameIndex,a=t.frames,i=this.props,n=i.axis,o=i.loop,h=i.minMove;switch(n){case"x":if(!1===o){if(0===s&&0<e)return"origin";if(s===a.length-1&&e<0)return"origin"}return Math.abs(e)<h?"origin":0<e?"right":"left";case"y":if(!1===o){if(0===s&&0<r)return"origin";if(s===a.length-1&&r<0)return"origin"}return Math.abs(r)<h?"origin":0<r?"down":"up"}},t.prototype.moveFramesBy=function(t,e){var r=this.state.movingFrames,s=r.prev,a=r.currentFrameIndex,i=r.next,n=this.state,o=n.frameWidth,h=n.frameHeight;switch(this.props.axis){case"x":translateXY(a,t,0),t<0?translateXY(i,t+o,0):translateXY(s,t-o,0);break;case"y":translateXY(a,0,e),e<0?translateXY(i,0,e+h):translateXY(s,0,e-h)}},t.prototype.prepareAutoSlide=function(){var t=this;if(!(this.state.frames.length<2)&&(this.clearAutoTimeout(),this.updateFrameSize(function(){t.prepareSiblingFrames()}),this.mounted&&this.props.loop&&this.props.auto)){var e=setTimeout(this.autoSlide,this.props.interval);this.setState({slider:e})}},t.prototype.autoSlide=function(t){var e=this;switch(this.clearAutoTimeout(),t){case"prev":this.transitFramesTowards("x"===this.props.axis?"right":"down");break;case"next":default:this.transitFramesTowards("x"===this.props.axis?"left":"up")}setTimeout(function(){return e.prepareAutoSlide()},this.props.duration)},t.prototype.next=function(){var t=this.state,e=t.currentFrameIndex,r=t.frames;if(!this.props.loop&&e===r.length-1)return!1;this.autoSlide("next")},t.prototype.prev=function(){if(!this.props.loop&&0===this.state.currentFrameIndex)return!1;var t=this.state.movingFrames,e=t.prev;e===t.next&&("x"===this.props.axis?translateXY(e,-this.state.frameWidth,0,0):translateXY(e,0,-this.state.frameHeight,0),e.getClientRects()),this.autoSlide("prev")},t.prototype.setFrame=function(t,e){var r=this;if(void 0===e&&(e=void 0),!e)return this.setState({currentFrameIndex:t}),void this.prepareSiblingFrames(!0,t);var s=Math.abs(t-this.state.currentFrameIndex);if(t<this.state.currentFrameIndex)for(var a=0;a<s;a++)setTimeout(function(){return r.prev()},a*e);else if(t>this.state.currentFrameIndex)for(var i=0;i<s;i++)setTimeout(function(){return r.next()},i*e)},t.prototype.clearAutoTimeout=function(){clearTimeout(this.state.slider)},t.prototype.updateFrameSize=function(t){if(this.refs.wrapper){var e=window.getComputedStyle(this.refs.wrapper),r=e.width,s=e.height;this.setState({frameWidth:parseFloat(r.split("px")[0]),frameHeight:parseFloat(s.split("px")[0])},t)}},t.prototype.getSiblingFrames=function(){return{currentFrameIndex:this.refs["f"+this.getFrameId()],prev:this.refs["f"+this.getFrameId("prev")],next:this.refs["f"+this.getFrameId("next")]}},t.prototype.getSiblingFramesByOverride=function(t){return{currentFrameIndex:this.refs["f"+t],prev:this.refs["f"+this.getFrameId("prev",t)],next:this.refs["f"+this.getFrameId("next",t)]}},t.prototype.prepareSiblingFrames=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=void 0);var r=t?this.getSiblingFramesByOverride(e):this.getSiblingFrames();return this.props.loop||(0===this.state.currentFrameIndex&&(r.prev=void 0),this.state.currentFrameIndex===this.state.frames.length-1&&(r.next=void 0)),this.setState({movingFrames:r}),translateXY(r.currentFrameIndex,0,0),"x"===this.props.axis?(translateXY(r.prev,-this.state.frameWidth,0),translateXY(r.next,this.state.frameWidth,0)):(translateXY(r.prev,0,-this.state.frameHeight),translateXY(r.next,0,this.state.frameHeight)),r},t.prototype.getFrameId=function(t,e){void 0===e&&(e=this.state.currentFrameIndex);var r=this.state.frames.length;switch(t){case"prev":return(e-1+r)%r;case"next":return(e+1)%r;default:return e}},t.prototype.transitFramesTowards=function(t){var e=this,r=this.state.movingFrames,s=r.prev,a=r.currentFrameIndex,i=r.next,n=this.props,o=n.duration,h=n.axis,p=n.onTransitionEnd,u=this.state.currentFrameIndex;switch(t){case"up":translateXY(a,0,-this.state.frameHeight,o),translateXY(i,0,0,o),u=this.getFrameId("next");break;case"down":translateXY(a,0,this.state.frameHeight,o),translateXY(s,0,0,o),u=this.getFrameId("prev");break;case"left":translateXY(a,-this.state.frameWidth,0,o),translateXY(i,0,0,o),u=this.getFrameId("next");break;case"right":translateXY(a,this.state.frameWidth,0,o),translateXY(s,0,0,o),u=this.getFrameId("prev");break;default:translateXY(a,0,0,o),"x"===h?(translateXY(s,-this.state.frameWidth,0,o),translateXY(i,this.state.frameWidth,0,o)):"y"===h&&(translateXY(s,0,-this.state.frameHeight,o),translateXY(i,0,this.state.frameHeight,o))}p&&setTimeout(function(){return p(e.getSiblingFrames())},o),this.setState({currentFrameIndex:u})},t.prototype.render=function(){var r=this,t=this.state,s=t.frames,a=t.currentFrameIndex,e=this.props,i=e.widgets,n=e.axis,o=e.loop,h=e.auto,p=e.interval,u=objectAssign(styles.wrapper,this.props.style);return React.createElement("div",{style:u},React.createElement("div",{ref:"wrapper",style:objectAssign({overflow:"hidden"},u),onTouchStart:this.onTouchStart,className:this.props.className,onMouseDown:this.onTouchStart},s.map(function(t,e){var r=objectAssign({zIndex:99-Math.abs(a-e)},styles.frame);return React.createElement("div",{ref:"f"+e,key:e,style:r},t)}),this.props.frames&&this.props.children),i&&[].concat(i).map(function(t,e){return React.createElement(t,{key:e,index:a,total:s.length,prevHandler:r.prev,nextHandler:r.next,setFrameHandler:r.setFrame,axis:n,loop:o,auto:h,interval:p})}))},t}(React.Component);function translateXY(t,e,r,s){void 0===s&&(s=0),t&&(t.style.opacity="1",t.style.transitionDuration=s+"ms",t.style.webkitTransitionDuration=s+"ms",t.style.transform="translate("+e+"px, "+r+"px)",t.style.webkitTransform="translate("+e+"px, "+r+"px) translateZ(0)")}function objectAssign(t){for(var e=arguments,r=Object(t),s=1;s<arguments.length;s++){var a=e[s];if(null!=a)for(var i in a)a.hasOwnProperty(i)&&(r[i]=a[i])}return r}Carousel.propTypes={axis:PropTypes.oneOf(["x","y"]),auto:PropTypes.bool,onStartFrameIndex:PropTypes.number,loop:PropTypes.bool,interval:PropTypes.number,duration:PropTypes.number,widgets:PropTypes.arrayOf(PropTypes.func),frames:PropTypes.arrayOf(PropTypes.element),style:PropTypes.object,minMove:PropTypes.number,onTransitionEnd:PropTypes.func},Carousel.defaultProps={axis:"x",auto:!1,onStartFrameIndex:0,loop:!1,interval:5e3,duration:300,minMove:42},module.exports=Carousel;
